EJEMPLO EXTRA DE AUTOMONTER NFS
================================

En serverX tengo unos recursos NFS exportados y quiero montarlos con automonter en desktopX.

PASOS:

Preparo serverX para exportar recursos, hago:

- Creo contenido en recursos exportados:

mkdir -p /ofertas/{viajes,productos,servicios}
mkdir /info

touch /ofertas/viajes/{caribe,islas,costa}.pdf
touch /ofertas/servicios/{hbo,netflix,limpieza}.pdf
touch /ofertas/productos/{thermomix,rumba,bq_m5}.pdf
echo "Enhorabuena, puedes ver el contenido del fichero" > /info/mensaje.txt

- Añado los recursos a exportar

echo "/ofertas/viajes  172.25.0.0/16(rw,sync)" >> /etc/exports
echo "/ofertas/productos  172.25.0.0/16(rw,sync)" >> /etc/exports
echo "/ofertas/servicios  172.25.0.0/16(rw,sync)" >> /etc/exports
echo "/info  172.25.0.0/16(rw,sync)" >> /etc/exports

- Arranco el servicio nfs-server y veo que exporta los recursos:

systemctl start nfs-server
exportfs -s  -> deben salir las 4 líneas

- Abro firewall para el NFS:

firewall-cmd --permament --add-service=nfs 
firewall-cmd --reload


En desktopX, hago:

  yum install -y tree 

1) Veo los recursos que exporta por NFS serverX:

   mount -t nfs serverx:/ /mnt; tree /mnt

  veo:
 
/mnt
├── info
│   └── mensaje.txt
└── ofertas
    ├── productos
    │   ├── bq_m5.pdf
    │   ├── rumba.pdf
    │   └── thermomix.pdf
    ├── servicios
    │   ├── hbo.pdf
    │   ├── limpieza.pdf
    │   └── netflix.pdf
    └── viajes
        ├── caribe.pdf
        ├── costa.pdf
        └── islas.pdf

  Decido montar con montaje directo /info en /serverX-info y con montaje indirecto /ofertas en /serverX-ofertas.

 umount /mnt

2) Instalo paquete autofs
   yum install -y autofs

3) Creo puntos de montaje:
   mkdir /serverX-{info,ofertas}

4) Creo montaje directo:

   echo "/- /etc/auto.info" >> /etc/auto.master.d/info.autofs   

   echo "/serverX-info -rw,sync serverX:/info" >> /etc/auto.info

5) Arranco servicio:
  
   systemctl start autofs && systemctl enable autofs

6) Accedo al directorio: ls /serverX  -info -> mensaje.txt y puedo ver contenido

7) Creo montaje indirecto:

   echo "/serverX-ofertas /etc/auto.ofertas" > /etc/auto.master.d/ofertas.autofs

   echo "* -rw,sync serverX:/ofertas/&" > /etc/auto.ofertas

8) Reinicio servicio autofs:

   systemctl restart autofs

9) Accedo al contenido de ofertas, p.e. viajes: 
   tree /serverX-ofertas/viajes
/serverX-ofertas/
└── viajes
    ├── caribe.pdf
    ├── costa.pdf
    └── islas.pdf

NOTA: Si hago un tree /serverX-ofertas no veo los subdirectorios, tengo que acceder explícitamente a ellos primero y luego ya se verán. Al rato desaparecen!!!




