EJERCICIO A DESARROLLAR EN serverX

0. Está el fichero /etc/shadow esta en un sistema de archivos montado con soporte acl?
Hint: para saber en que FS està /etc/shadow usar el comando df

	df 
	Veo que / está en /dev/vda1
	blkid /dev/vda1
	veo que es un fs de tipo xfs que lleva implementado nativamente las acls

1. Hacer una copia del /etc/shadow en /home

	 su -
	 cp /etc/shadow /home

2. Permitir al usuario foobar leer y escribir, el file /home/shadow.

	 useradd foobar
	 ls -ld -> veo que cualquier usuario tiene permiso de lectura y ejecución en /home
	 setfacl -m u:foobar:rw /home/shadow 
	 getfacl /home/shadow
	------------------------------------------------------
	getfacl: Removing leading '/' from absolute path names
	# file: home/shadow
	# owner: root
	# group: root
	user::---
	user:foobar:rw-
	group::---
	mask::rw-
	other::---
	-------------------------------------------------------

3. Dar una máscara al file /home/shadow que permita leer y no escribir al grupo, usuarios con nombre y grupos con nombre.

	chmod g-wx /home/shadow   ó    chmod g=r /home/shadow   ó   setfacl -m m::r /home/shadow

4.  Si la máscara permite solo leer que permisos efectivos tendrá foobar?

	Sólo lectura porque la máscara le limita sus permisos de rw a sólo r.

5. Crear el usuario usera con password usera, y copiar en su home el file /bin/false.

	useradd usera; echo usera | passwd --stdin usera
	cp /bin/false /home/usera/

6. usera tiene que pertenecer al grupo root.

	usermod -aG root usera
	
7. root tiene que ser el propietario del file /bin/false que ha sido copiado en la home de usera, darle el SUID a la copia del file.

	ls -la /home/usera/false -> ya es de root
	chmod u+s /home/usera/false

8. Añadir el usuario foobar al grupo gruppo

	groupadd gruppo
	usermod -aG gruppo foobar

9. Permitir a los usuarios que pertenecen al grupo propietario del file /home/usera/false y al grupo gruppo, leer, escribir y ejecutar el file. Impedir cualquier tipo de acceso a los demás usuarios.

	ls -ld /home/usera/false -> veo que el grupo propietario es root
	setfacl -m g::rwx /home/usera/false
	setfacl -m g:root:rx /home/usera       <- OJO, tengo que dejarle pasar por el directorio donde está el fichero
	setfacl -m g:gruppo:rwx /home/usera/false
	setfacl -m g:gruppo:rx /home/usera
	chmod o-rwx /home/usera/false -> no sería necesario porque others sobre el home de usera no tiene permiso para acceder.

10. Crear el directorio /datti.

	mkdir /datti
	ls -ld /datti

11. Crear un directorio llamado colabora en /datti. Este directorio tiene que ser colaborativo para el grupo grupppo al cual pertenecen foobar y usera, solo los del grupo propietario podrán leer, modificar y acceder a este directorio.

	groupadd grupppo
	for user in foobar usera;do usermod -aG grupppo $user;done
	mkdir /datti/colabora
	chown :grupppo /datti/colabora
	chmod g+ws,o-rwx /datti/colabora   o   chmod g+wx,o= /datti/colabora

12. El usuario mick necesitará también colaborar con el grupo grupppo, pero solo dándole acceso y permiso de listar lo que hay en el directorio, pero además mick podrá leer los nuevos files creados dentro. 

	useradd mick; echo mick | passwd --stdin mick
	setfacl -m u:mick:rX /datti/colabora
	setfacl -Rm d:u:mick:rX /datti/colabora

